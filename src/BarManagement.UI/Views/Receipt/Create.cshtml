@model BarManagement.UI.Models.Receipt.CreateReceiptViewModel;

<style>
    .dropdown-menu.show {
        display: block;
        max-height: 200px;
        overflow-y: auto;
        position: absolute;
    }

    .dropdown-item.disabled {
        color: #6c757d;
    }
</style>


<div class="container">
    <form method="post" asp-controller="Receipt" asp-action="Create" onsubmit="submitForm(event)">
        <div class="p-3 mt-4">
            <div class="row pb-2">
                <h2>Create Receipt</h2>
                <hr />
            </div>
            <div>
                <h4>Drinks</h4>
                <input type="text" id="drink-search" class="form-control" placeholder="Search drinks" oninput="searchDrinks()">
                <div id="drink-search-results" class="dropdown-menu show"></div>
                <div class="drink-ids mt-2 mb-2" id="drink-ids"></div>
            </div>
            <div>
                <h4>Coctails</h4>
                <input type="text" id="coctail-search" class="form-control" placeholder="Search coctails" oninput="searchCoctails()">
                <div id="coctail-search-results" class="dropdown-menu show"></div>
                <div class="coctail-ids mt-2 mb-2" id="coctail-ids"></div>
            </div>
            <div id="hidden-inputs-container" style="display: none;"></div>
            <button type="submit" class="btn btn-primary btn-custom" style="width:150px">Create</button>
            <a asp-controller="Receipt" asp-action="GetAll" class="btn btn-secondary" style="width:150px">Back To List</a>
        </div>
    </form>
</div>

@section Scripts {
    @{
        <partial name="_ValidationScriptsPartial" />
    }
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
    <script>
        function searchDrinks() {
            var search = $('#drink-search').val();
            if (search.length > 2) {
                $.getJSON('/Drinks/SearchDrinks', { search: search }, function (data) {
                    var dropdown = $('#drink-search-results').empty();
                    if (data.length === 0) {
                        dropdown.append('<button type="button" class="dropdown-item disabled">No results found</button>');
                    } else {
                        data.forEach(function (item) {
                            dropdown.append('<button type="button" class="dropdown-item" onclick="selectDrink(\'' + item.id + '\', \'' + item.name + '\')">' + item.name + '</button>');
                        });
                    }
                    dropdown.show();
                }).fail(function () {
                    console.error("Error fetching drinks");
                });
            }
        }

        function searchCoctails() {
            var search = $('#coctail-search').val();
            if (search.length > 2) {
                $.getJSON('/Coctails/SearchCoctails', { search: search }, function (data) {
                    var dropdown = $('#coctail-search-results').empty();
                    if (data.length === 0) {
                        dropdown.append('<button type="button" class="dropdown-item disabled">No results found</button>');
                    } else {
                        data.forEach(function (item) {
                            dropdown.append('<button type="button" class="dropdown-item" onclick="selectCoctail(\'' + item.id + '\', \'' + item.name + '\')">' + item.name + '</button>');
                        });
                    }
                    dropdown.show();
                }).fail(function () {
                    console.error("Error fetching coctails");
                });
            }
        }

        function selectDrink(id, name) {
            var container = $('#drink-ids');
            container.append('<div class="mb-2"><input type="text" class="form-control" value="' + name + '" disabled><input type="hidden" name="DrinkIds" value="' + id + '"></div>');
            $('#drink-search-results').hide();
            $('#drink-search').val('');
        }

        function selectCoctail(id, name) {
            var container = $('#coctail-ids');
            container.append('<div class="mb-2"><input type="text" class="form-control" value="' + name + '" disabled><input type="hidden" name="CoctailIds" value="' + id + '"></div>');
            $('#coctail-search-results').hide();
            $('#coctail-search').val('');
        }

        function submitForm(event) {
            event.preventDefault();
            document.querySelector('form').submit();
        }
    </script>
}
